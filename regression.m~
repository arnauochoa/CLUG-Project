function [result, coeffMean, coeffVar, sqrtErr, coeffMean2] = regression(DATA, CONFIG)
% ----------------------------------------------------------------------------------------
% This function applies the regression technique selected in configuration
%
% INPUT
%           DATA:       Struct. Input data
%           CONFIG:     Struct. Configuration parameters
%
% OUTPUT
%           result:     ....    
%
% ----------------------------------------------------------------------------------------
    
    result = 0;

    switch CONFIG.REGRESSION_METHOD
        case 1 % MATLAB curve fitting function
            % Curve fitting for the mean of the random noise
            coeffMean   =   polyfit(DATA.X, DATA.Y, 2);
            
            % Curve fitting for the variance of the random noise
            meanReg     =   polyval(coeffMean, DATA.X);
            sqrtErr     =   (DATA.Y - meanReg).^2;
            coeffVar    =   fit(DATA.X', sqrtErr','exp1');  % 	Y = a*exp(b*x)
            
            % Obtain weights
            fMean       =   polyval(coeffMean, DATA.X);
            meanWeights =   1./fMean;
            varWeigths  =   1./coeffVar(DATA.X);
            
            % Recompute regression for mean and variance
            coeffMean2  =   fit(DATA.X, DATA.Y, 'poly2', 'Weights', meanWeights);
            coeffVar2   =   fit(DATA.X, sqrtErr, 'exp1', 'Weights', varWeigths);
            
            
        case 2 % Custom classical regression model
            % TODO
            
        case 3 % Machine learning
            % TODO
            
    end
    
end